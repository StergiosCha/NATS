{% extends "base.html" %}
{% block title %}Analysis Results - NATS{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Document Embeddings Visualization -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4">Document Embeddings</h2>
        <div id="embeddingsPlot" class="w-full h-[400px]"></div>
    </div>

    <!-- Files Table -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4">Uploaded Files</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead>
                    <tr>
                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase">Filename</th>
                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase">Content Preview</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for filename, data in files.items() %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">{{ filename }}</td>
                        <td class="px-6 py-4">{{ data.text[:100] }}...</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Plotly for visualizations -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const embeddings = {{ embeddings|tojson }};
    
    // Create scatter plot
    const data = [{
        type: 'scatter',
        mode: 'markers+text',
        x: embeddings.map(e => e[0]),
        y: embeddings.map(e => e[1]),
        text: Object.keys({{ files|tojson }}),
        textposition: 'top center',
        marker: {
            size: 10,
            color: 'blue'
        }
    }];

    const layout = {
        title: 'Document Similarity Space',
        xaxis: { title: 'Dimension 1' },
        yaxis: { title: 'Dimension 2' }
    };

    Plotly.newPlot('embeddingsPlot', data, layout);
});
</script>
{% endblock %}
