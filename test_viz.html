<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Visualizations</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .chart { width: 100%; height: 400px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Test Plotly Visualizations</h1>
    
    <div class="test-section">
        <h2>Test 1: Simple Chart</h2>
        <div id="test1" class="chart"></div>
        <button onclick="testSimpleChart()">Create Simple Chart</button>
    </div>
    
    <div class="test-section">
        <h2>Test 2: API Data</h2>
        <div id="test2" class="chart"></div>
        <button onclick="testApiData()">Load API Data</button>
    </div>
    
    <div id="debug"></div>

    <script>
        function testSimpleChart() {
            const data = [{
                x: ['A', 'B', 'C'],
                y: [1, 3, 2],
                type: 'bar'
            }];
            
            const layout = {
                title: 'Simple Test Chart'
            };
            
            try {
                Plotly.newPlot('test1', data, layout, {responsive: true});
                document.getElementById('debug').innerHTML += '<p>✅ Simple chart created successfully</p>';
            } catch (error) {
                document.getElementById('debug').innerHTML += '<p>❌ Error creating simple chart: ' + error.message + '</p>';
            }
        }
        
        async function testApiData() {
            try {
                // Create test data
                const formData = new FormData();
                const testFile = new File(['This is a test document with entities like John Smith from New York City and Microsoft Corporation.'], 'test.txt', {type: 'text/plain'});
                formData.append('files', testFile);
                formData.append('analysis_type', 'enhanced_ner');
                
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                document.getElementById('debug').innerHTML += '<p>✅ API response received</p>';
                
                if (data.results && data.results.entities) {
                    const filename = Object.keys(data.results.entities)[0];
                    const entityData = data.results.entities[filename];
                    
                    if (entityData.visualizations && entityData.visualizations.entity_plot) {
                        const viz = entityData.visualizations.entity_plot;
                        document.getElementById('debug').innerHTML += '<p>✅ Found visualization data</p>';
                        document.getElementById('debug').innerHTML += '<p>Viz type: ' + viz.type + '</p>';
                        document.getElementById('debug').innerHTML += '<p>Data length: ' + viz.data.length + '</p>';
                        
                        if (viz.type === 'plotly') {
                            try {
                                Plotly.newPlot('test2', viz.data, viz.layout, {responsive: true});
                                document.getElementById('debug').innerHTML += '<p>✅ API chart created successfully</p>';
                            } catch (error) {
                                document.getElementById('debug').innerHTML += '<p>❌ Error creating API chart: ' + error.message + '</p>';
                            }
                        }
                    } else {
                        document.getElementById('debug').innerHTML += '<p>❌ No visualization data found</p>';
                    }
                } else {
                    document.getElementById('debug').innerHTML += '<p>❌ No results found</p>';
                }
                
            } catch (error) {
                document.getElementById('debug').innerHTML += '<p>❌ API Error: ' + error.message + '</p>';
            }
        }
        
        // Test Plotly availability
        if (typeof Plotly !== 'undefined') {
            document.getElementById('debug').innerHTML += '<p>✅ Plotly.js loaded successfully</p>';
        } else {
            document.getElementById('debug').innerHTML += '<p>❌ Plotly.js not loaded</p>';
        }
    </script>
</body>
</html>








